# Как превратить прототип в настоящий Minecraft-мод (Fabric 1.20.1)

Ниже практический план, как взять текущую доменную логику и интегрировать её в игру.

## 1) Создать Fabric-проект
Самый быстрый путь — через шаблон Fabric Example Mod:
1. Создай новый репозиторий/ветку с Fabric-шаблоном.
2. Укажи версии:
   - Minecraft: `1.20.1`
   - Java: `17`
   - Fabric Loader: `0.15+`
3. Добавь Fabric API.

> Текущий репозиторий можно использовать как модуль `core` (домен), а Fabric-код держать в `fabric` модуле.

## 2) Перенести core-логику
Классы из `src/main/java/com/example/magicmod` оставляй почти без изменений:
- `Spell`, `SpellRegistry`
- `SpellScroll`
- `ArcaneWorkbench`, `ArcaneCraftingResult`
- `PlayerMagicProfile`
- `SpellEngine`

Их задача — правила игры. Они не должны зависеть от Fabric/MC классов.

## 3) Добавить хранение данных игрока (персистентность)
Требование «после изучения свитка навсегда» реализуется через player persistent data:
- Сохраняй `learnedSpells`, `magicLevel`, `magicExperience`, `currentMana`, `keyBinds` в NBT.
- Загружай при входе игрока/респауне/перезаходе.

Минимум:
- Mixin или Component-подход для `ServerPlayerEntity`.
- Сериализация/десериализация в NBT каждый autosave/logout.

## 4) Сделать предметы
Нужны предметы:
- `spell_scroll` (или по одному предмету на каждое заклинание, или один Item с NBT `spellId`)
- `research_scroll` (инструмент для открытия GUI 9x9)

Поведение:
- ПКМ по `spell_scroll` => вызывай `SpellScroll.learn(...)`.
- Если успешно: анимация/звук/сообщение и удаление/расход свитка.

## 5) Реализовать блок/GUI «магический стол» 9x9
Ванильный крафт 3x3, значит 9x9 нужно делать своим экраном:
- Свой `Block` (Arcane Workbench).
- `ScreenHandler` + `Screen` на 81 слот.
- При нажатии кнопки «Синтез» формируй строку-паттерн из 81 символа и вызывай `ArcaneWorkbench.craft(...)`.

Обработка результатов:
- `SPELL_SCROLL` => выдать предмет свитка с нужным `spellId`.
- `MAGIC_EXPLOSION` => создать взрыв/урон/эффект частиц.
- `NOTHING` => ничего не выдавать (можно дать фидбек игроку).

## 6) Реализовать меню биндов заклинаний
Сделай клиентский экран «Spell Bind Menu»:
- Показывает изученные заклинания.
- Позволяет назначать на клавиши 1..9.
- После изменения отправляй C2S пакет на сервер.
- На сервере применяй `profile.bindSpellToKey(...)`.

Важно: сервер должен быть источником правды (валидация, что заклинание изучено).

## 7) Каст заклинаний по нажатию клавиш
На клиенте регистрируй `KeyBinding` (например, 1..9 для слотов магии):
- По нажатию отправляй пакет `CastBoundSpellPacket(slotOrKey)`.
- На сервере вызывай `SpellEngine.castBoundSpell(profile, keyCode)`.

Если каста не произошло (не хватает маны/уровня):
- отправь игроку action bar сообщение с причиной.

## 8) Синхронизация маны и уровня
Чтобы HUD был корректный:
- Сервер хранит истину.
- При изменении маны/уровня отправляй S2C-пакет.
- На клиенте рендерь шкалу маны и уровень (HUD overlay).

## 9) Баланс и расширение заклинаний
Для масштабирования вынеси заклинания в data-driven формат:
- JSON: `id`, `manaCost`, `levelRequirement`, `castType`, параметры урона/радиуса.
- При старте загружай в `SpellRegistry`.

Так можно добавлять заклинания без перекомпиляции.

## 10) Что с версиями дальше
Если нужен максимальный охват модпаков:
- сначала выпусти 1.20.1;
- затем переноси на 1.20.4/1.21.x.

Логику из текущего core-пакета переносить проще, чем сразу писать всё на API конкретной версии.

---

## Короткий ответ на твой вопрос
- **Сейчас:** это версия «прототип логики», не привязанная к Minecraft.
- **Чтобы превратить в мод:** нужен Fabric/Forge слой (регистрация предметов/блоков, GUI, пакеты, NBT, keybind-и).
- **Рекомендуемая целевая версия:** **Minecraft 1.20.1 + Fabric API + Java 17**.
